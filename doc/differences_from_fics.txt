Copyright (C) 2010 by Wil Mahan
This is just a rough draft; please don't distribute it yet.

= Changes from original FICS =

== Differences for users ==

* The server is stricter about the format of moves entered.  Moves should
be in Standard Algebraic Notation or long algebraic notation.  In particular,
moves are now case-sensitive, so that a move like bxb3 (pawn capture) is
unambiguous with Bxb3 (bishop capture).  Users of graphical clients (that
is, the vast majority of users) should not notice this change.
Rationale: Standard algebraic notation is, well, standard, but the current
case-insensitivity violates the standard.  This change will make the
server more compatible with programs that produce SAN.

* Vars intentionally not implemented: availinfo, availmin, availmax, rated,
pgn, tolerance, ropen.
Rationale: I hope they have few enough users that they can be marked
obsolete and not implemented.  Games are always mailed as pgn.  The
"tolerance" var is replaced by the new "seclude" var (see New features).
In my opinion "tolerance" was not sufficient for its stated purpose of
blocking offensive communications.  If there is still demand for a
keyword filter, it is more logically implemented on the client side.

* The error messages given when logging in (for names that are
too short, too long, or contain disallowed characters) have been
reworded.
Rationale: consiceness and consistency of messages.

* "Drawn by mutual agreement" has been shortened to "Drawn by agreement".
Rationale: conciseness.

* If an alias contains invalid syntax (such as a bare $), the server will
print an error message rather than trying to execute the command anyway.
Rationale: Avoid hiding user errors.

* When attempting to send a tell to a name that does not exist or user who
is not online, the error message is "No user named HANDLE is logged in",
rather than "HANDLE is not logged in".
Rationale: This is is an attempt to clarify that the name may or may not be
a registered user.

* The "teams" list has been removed.
Rationale: It's obsolete.

* The behavior of empty finger note lines is different. For example,
if you have only note 1 set, and you set note 5, notes 2-4 will
automatically be filled with blank lines.  Subsequently deleting
note 5 will clear notes 2-4 again.
Rationale: intended to be more intuitive.

* The "inchannel" command, when invoked on an emtpy channel, prints
"There are 0 players in channel N", rather than "Channel N is empty".
Rationale: easier for the server to generate and easier for a bot to
parse.

* If you prefix a command with "$$" to avoid updating your idle time,
aliases are now used.  To avoid using aliases (the old behavior
of "$$"), use "$$$".
Rationale: allow executing a command with aliases,
without updating idle time.

* If you enter a move (such as "e2e4") while you aren't playing a game,
you'll now receive the generic "Command not found" message, rather than
"You are not playing or examining a game".
Rationale: simplifies the server implementation slightly; hopefully
won't cause any user confusion.

* If you use the "." alias to tell the last told player, and that player
has logged off, you now get the error message "HANDLE is no longer online",
rather than "I don't know who to tell that to".  Also, if the player
logs back on, you can immediately use "." again, so a temporary
disconnection should not interrupt the flow of a conversation.
Rationale: more informative and user-friendly.

* If a game is aborted on move 1, the printed result now includes the
name of the player who requested the abort.
Rationale: more informative.

* When setting a password, the server does not print the password back
to you, but rather replaces it with asterisks.
Rationale: make it harder from someone else to read the password
over your shoulder, although it is still visible when you type it.

* You can no longer use the "it" command if you are not listening to shouts.
Rationale: Help prevent accidentally sending "i" shouts.

* Crazyhouse: draw by repetition now requires that the entire game
state, including pieces in holding and which pieces are promoted
from pawns, be repeated.  (Original FICS only considers the
position on the board.)  http://www.tonyjh.com/chess/zh_notes.html
describes this issue.  Also, the material strength sent with
style 12 uses the crazyhouse values from that page rather than those
of normal chess: P = 1; N,B,R = 2; Q = 4.

== Differences for interface and bot authors ==
* Newlines are now sent after carriage returns ('\r\n'), rather than
vice versa ('\n\r'). (This affects some bots and interfaces, but typical
users should not have to worry about it.)
Rationale: Dating back to the original teletype machines, the order is
conventionally '\r\n'.
* In style 12, an en passant square is only set when there is a legal
en passant capture.

* Draws by repetition are handled differently:
** Currently it is possible to move out of a position that was
a third repetition and claim a draw before your opponent moves,
regardless of what your move is.  Thus it is possible to, say,
throw away your queen and still claim a draw.  This loophole
has been fixed; you must claim the draw on your own turn if the
claim is based not on the current position but on the previous
position.  Note that neither the old nor the new behavior adheres
to the FIDE laws of chess; I chose to make my implementation
similar to the existing system rather than correct by the rules,
which were designed for OTB play.  (This is a complex issue, so
maybe I should write up a more detailed explanation.)
** At present FICS fails to consider en passant capturing rights (and
possibly castling rights; I haven't checked) when checking a draw
by repetition claim.  This is incorrect according to rule 9.2 of
the FIDE laws of chess.  For discussion see
http://en.wikipedia.org/wiki/Threefold_repetition#Incorrect_claims .
For just one example of where FICS gets this wrong, see
http://ficsgames.com/cgi-bin/show.cgi?ID=182672306;action=show .
The new server fixes this bug.

* The "promote" command and "promove" variable have been removed.
Instead of using it, users and clients should specify the
promotion piece with the move; for example, e8=N (SAN) or
e7e8=N (long algebraic notation).  If no promotion piece is
specified, queen is always assumed.

* ECO codes for openings now use the database from scid
( http://scid.sourceforge.net ).  ECO now considers castling
and en passant rights.

Rationale:
The scid database is more comprehensive, and subdivides ECO codes for
more specificity.  Also, transpositions may be handled better.  I could
not find a database of NIC codes by moves, but it might be possible
to create one if there is demand.

* All ratings begin at 1720 for new users.
Rationale: try to decrease the disparity between blitz and standard
ratings; simpler to implement.  Previously standard ratings began
at 1799.

== Admin differences ==
* The following commands now require an exact login and do not accept
abbreviations of player names:  "asetadminlevel", "asetpasswd", "nuke".
Rationale: These commands should be used with great care.

== New features ==
* Full support for international characters
* Dynamically switch the language of FICS messages
* New timeseal with support for sending international characters.
===Not done yet===
* Timeseal has compression of data sent from server to client;
timeseal supports pinging.
* New "seclude" variable.  When it is set, all communications to the
user are blocked for the entire session, including personal tells,
channel tells, shouts, c-chouts, and messages, with the following
exceptions: tells by admins, announcements, tells in channel 1.  The
purpose is to allow playing without seeing potentially offensive
communications.
* New "country" variable.  The sole purpose of this var is to allow
interfaces to display a country flag for users who choose to set it.
This var is optional and should not be set by an interface without a
user's explicit permission.
* New channel features: anyone can create his or her own channel;
channel topics; messages to channels.  Channels below 1024 are
managed by admins; there should be plenty of channels above that
unofficial categories (the current limit is about 2 billion).
* Multi-command aliases: separate commands in aliases with a
semicolon (;).
* New "slow" time control, for games longer than an hour.
* Support for correspondence games.
* Rating pools.
* Automatic lag-detection features.
* Unlimited lists like censor and noplay.
* New variants; existing variant ratings split into lightning, blitz,
standard, slow, and correspondence.
* Glicko 2 ratings, which are like the Glicko FICS currently uses but
add a volatility measure.

== Changes I would like to make, but which need discussion first ==
* These commands are deprecated: "open", "bell", "flip", "simopen",
"style". (A similar command was "promote" but I removed it
entirely.)
Rationale: for interface consistency, encourage always using the "set"
command to change vars.
* A new rshout command for announcing relays, so users who do not
care about relays can "set rshout 0".
Rationale: Currently announcements are used, so it is not possible to
unsubscribe.
* The concept of "server time" no longer exists.  All times are in local
time or UTC.
Rationale: UTC is the standard way of coordinating times from around
the world.
* Admins can no longer use the qtell command unless they are on the
TD list.
Rationale: simpler.

== Changes I considered but rejected ==
* Preventing a player from logging out when starting a game: if a
player wants to log out, there's no way to stop him or her from
closing the interface.  It's better that we know the user has
intentionally logged out.
* Numbers and punctuation in player names: possible, but perhaps too
disruptive to the existing conventions and too ripe for abuse.
* International (non-ASCII) characters in names: in my opinion
this is bad because not all players can type non-ASCII characters,
which could make it difficult to finger, tell, or match users with
such names.
* Named channels (such as #help as an alias for channel 1): probably
too disruptive to established conventions.
* Multi-line messages: maybe possible for the future, but we would need
to be careful to prevent spam.
* Extra censor features like automatically expiring censor lists or
censoring but still playing users.  Basically, I think censoring should
be a last resort and don't want to encourage indiscriminate use of
censor lists, because in my opinion they are a suboptimal solution to 
antisocial behavior (maybe I should write up a more detailed explanation).
* The ability to play games using the FIDE rules for draws, i.e.
you can only claim a draw on your own turn and claims may only be based
on the current position.  This could be added as an option if there is
interest.
* Time odds (It appears they were once possible with the old FICS but
the feature was removed.)  A similar effect can be achieved if one
player simply grants moretime at the beginning of a game.  It is not
possible to give different increments to each player this way, but
that seems like a very esoteric feature.
* Increase history games to 100.  Just use hstat instead?

== I changed my mind about these so I need to undo them ==
* Gods can now set their own adminlevel. Not sure if it's useful, but it
follows the principle of "gods can do anything".
* It's no longer possible go give a guest a title (athough it is still
possible to set a guest's adminlevel).

== Internal differences ==
* Server is written in Python 2.7 with twisted (the original FICS
is in C).  I/O is asynchronous, and on Linux 2.6, epoll() is used for
better scalability than the traditional select().
* The server uses a relational database for better load balancing
and exporting of data to external applications like ficsgames.com.
* Game history is stored as PGN.
* Rather using than a global array of all challenges, the server
stores each player's lists of challenges sent and received separately.
* Lists like noplay and censor are stored as Python sets, which allows
tests for set membership in O(1) average time and O(n) worst-case.
* (Minor) Channel tells no longer iterate over all logged-in users, but
only users subscribed to the channel.

== Errors in FICS documentation ==
* "help match" says "Matching yourself ( "match your_handle") is a way to enter
   examine mode".

